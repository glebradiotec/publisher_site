<header class="sticky top-4 z-50 w-full px-4 sm:px-6 lg:px-8">
    <div class="max-w-[1200px] mx-auto bg-white/70 [data-theme=dark]:bg-surface-dark/70 backdrop-blur-xl border border-white/50 [data-theme=dark]:border-white/10 rounded-2xl shadow-sm">
        <div class="flex h-16 items-center justify-between px-4 sm:px-6">

            <!-- Language switcher -->
            <div class="flex items-center gap-1">
                <button id="lang-ru" class="lang-btn" title="–†—É—Å—Å–∫–∏–π" style="background:none; border:none; padding:0; cursor:pointer; opacity:0.5; transition:opacity 0.3s; font-size:28px; line-height:1;">üá∑üá∫</button>
                <button id="lang-en" class="lang-btn" title="English" style="background:none; border:none; padding:0; cursor:pointer; opacity:0.5; transition:opacity 0.3s; font-size:28px; line-height:1;">üá¨üáß</button>
            </div>

            <!-- Navigation -->
            <nav class="hidden md:flex items-center gap-8">
                <a class="text-sm font-semibold text-text-main/70 hover:text-primary transition-colors [data-theme=dark]:text-gray-300 no-underline" href="/journals">–ñ—É—Ä–Ω–∞–ª—ã</a>
                <a class="text-sm font-semibold text-text-main/70 hover:text-primary transition-colors [data-theme=dark]:text-gray-300 no-underline" href="/search">–ü–æ–∏—Å–∫</a>
                <a class="text-sm font-semibold text-text-main/70 hover:text-primary transition-colors [data-theme=dark]:text-gray-300 no-underline" href="/about">–û –Ω–∞—Å</a>
                <a class="text-sm font-semibold text-text-main/70 hover:text-primary transition-colors [data-theme=dark]:text-gray-300 no-underline" href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
                <a class="text-sm font-semibold text-text-main/70 hover:text-primary transition-colors [data-theme=dark]:text-gray-300 no-underline" href="/delivery">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</a>
            </nav>

            <!-- Right side -->
            <div class="flex items-center gap-3">
                <!-- Login button + dropdown -->
                <div class="relative" id="login-container">
                    <button id="login-toggle" class="hidden sm:flex text-sm font-bold text-text-main [data-theme=dark]:text-white hover:text-primary px-3 py-2 rounded-lg hover:bg-gray-50 [data-theme=dark]:hover:bg-white/5 transition-all cursor-pointer" style="background:none; border:none;">
                        –í–æ–π—Ç–∏
                    </button>

                    <!-- Login dropdown -->
                    <div id="login-dropdown" style="display:none; position:absolute; right:0; top:calc(100% + 8px); z-index:100; width:300px;">
                        <div style="background:white; border-radius:16px; box-shadow:0 20px 60px -10px rgba(0,0,0,0.15); border:1px solid rgba(0,0,0,0.06); padding:24px; position:relative;">
                            <!-- Arrow -->
                            <div style="position:absolute; top:-6px; right:20px; width:12px; height:12px; background:white; border-left:1px solid rgba(0,0,0,0.06); border-top:1px solid rgba(0,0,0,0.06); transform:rotate(45deg);"></div>

                            <h3 style="margin:0 0 16px 0; font-size:16px; font-weight:700; text-align:center; color:#0f172a;" class="font-display">–í—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å</h3>

                            <form method="post" action="/admin/login" id="login-form">
                                <div style="margin-bottom:12px;">
                                    <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω" required
                                           style="width:100%; padding:10px 14px; border:1.5px solid #e2e8f0; border-radius:10px; font-size:14px; outline:none; transition:border-color 0.2s; background:#f8fafc; box-sizing:border-box;"
                                           onfocus="this.style.borderColor='#0D9488'; this.style.background='#fff';"
                                           onblur="this.style.borderColor='#e2e8f0'; this.style.background='#f8fafc';">
                                </div>
                                <div style="margin-bottom:16px;">
                                    <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required
                                           style="width:100%; padding:10px 14px; border:1.5px solid #e2e8f0; border-radius:10px; font-size:14px; outline:none; transition:border-color 0.2s; background:#f8fafc; box-sizing:border-box;"
                                           onfocus="this.style.borderColor='#0D9488'; this.style.background='#fff';"
                                           onblur="this.style.borderColor='#e2e8f0'; this.style.background='#f8fafc';">
                                </div>
                                <div id="login-error" style="display:none; color:#dc2626; font-size:13px; font-weight:600; text-align:center; margin-bottom:12px;"></div>
                                <button type="submit"
                                        style="width:100%; padding:10px; background:#0D9488; color:#fff; border:none; border-radius:10px; font-size:14px; font-weight:700; cursor:pointer; transition:background 0.2s;"
                                        onmouseenter="this.style.background='#115E59'"
                                        onmouseleave="this.style.background='#0D9488'">
                                    –í–æ–π—Ç–∏
                                </button>
                            </form>
                        </div>
                    </div>
                </div>

                <button id="theme-toggle" class="flex items-center justify-center w-10 h-10 rounded-xl border border-gray-200 [data-theme=dark]:border-gray-700 hover:border-primary hover:text-primary transition-colors bg-white/50 [data-theme=dark]:bg-surface-dark/50" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                    <span id="theme-icon" class="material-symbols-outlined text-[20px]">dark_mode</span>
                </button>
            </div>
        </div>
    </div>
</header>

<style>
    .lang-btn:hover { opacity: 0.8 !important; }
    .lang-btn.active { opacity: 1 !important; }

    [data-theme="dark"] #login-dropdown > div {
        background: #1e293b !important;
        border-color: rgba(255,255,255,0.1) !important;
    }
    [data-theme="dark"] #login-dropdown > div > div:first-child {
        background: #1e293b !important;
        border-color: rgba(255,255,255,0.1) !important;
    }
    [data-theme="dark"] #login-dropdown h3 { color: #fff !important; }
    [data-theme="dark"] #login-dropdown input {
        background: #0f172a !important;
        border-color: #334155 !important;
        color: #fff !important;
    }
    [data-theme="dark"] #login-dropdown input:focus {
        border-color: #0D9488 !important;
        background: #1e293b !important;
    }
</style>

<script>
    // Theme toggle
    var savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    if (savedTheme === 'dark') document.documentElement.classList.add('dark');
    else document.documentElement.classList.remove('dark');
    updateThemeIcon(savedTheme);

    document.getElementById('theme-toggle').addEventListener('click', function() {
        var current = document.documentElement.getAttribute('data-theme');
        var newTheme = current === 'light' ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', newTheme);
        if (newTheme === 'dark') document.documentElement.classList.add('dark');
        else document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
    });

    function updateThemeIcon(theme) {
        document.getElementById('theme-icon').textContent = theme === 'dark' ? 'light_mode' : 'dark_mode';
    }

    // Language switcher
    (function() {
        var lang = localStorage.getItem('lang') || 'ru';
        setLang(lang);
        document.getElementById('lang-ru').addEventListener('click', function() { setLang('ru'); });
        document.getElementById('lang-en').addEventListener('click', function() { setLang('en'); });
        function setLang(l) {
            localStorage.setItem('lang', l);
            document.documentElement.setAttribute('data-lang', l);
            document.getElementById('lang-ru').classList.toggle('active', l === 'ru');
            document.getElementById('lang-en').classList.toggle('active', l === 'en');
        }
    })();

    // Login dropdown
    (function() {
        var toggle = document.getElementById('login-toggle');
        var dropdown = document.getElementById('login-dropdown');
        var form = document.getElementById('login-form');
        var errorEl = document.getElementById('login-error');
        if (!toggle || !dropdown) return;

        toggle.addEventListener('click', function(e) {
            e.stopPropagation();
            var open = dropdown.style.display !== 'none';
            dropdown.style.display = open ? 'none' : 'block';
            if (!open) {
                setTimeout(function() { form.querySelector('input[name="username"]').focus(); }, 50);
            }
        });

        // Close on click outside
        document.addEventListener('click', function(e) {
            if (!document.getElementById('login-container').contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });

        // Close on Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') dropdown.style.display = 'none';
        });

        // AJAX submit
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            errorEl.style.display = 'none';
            var formData = new FormData(form);

            fetch('/admin/login', {
                method: 'POST',
                body: formData,
                redirect: 'follow'
            }).then(function(resp) {
                if (resp.redirected) {
                    window.location.href = resp.url;
                } else {
                    return resp.text().then(function(html) {
                        if (html.indexOf('–ù–µ–≤–µ—Ä–Ω—ã–π') !== -1 || html.indexOf('error') !== -1) {
                            errorEl.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å';
                            errorEl.style.display = 'block';
                            form.querySelector('input[name="password"]').value = '';
                            form.querySelector('input[name="password"]').focus();
                        } else {
                            window.location.href = '/admin';
                        }
                    });
                }
            }).catch(function() {
                errorEl.textContent = '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
                errorEl.style.display = 'block';
            });
        });
    })();
</script>

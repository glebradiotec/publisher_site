{% extends "base.html" %}
{% block title %}Поиск{% if query %}: {{ query }}{% endif %} — Издательство{% endblock %}

{% block content %}
<div class="container page-section">
    <ul class="breadcrumbs">
        <li><a href="/">Главная</a></li>
        <li><span class="breadcrumb-current">Поиск</span></li>
    </ul>

    <div class="page-header">
        <h1>Поиск</h1>
    </div>

    <!-- Поисковая строка -->
    <div class="search-section" style="margin-bottom: 24px;">
        <form action="/search" method="get">
            <div class="search-input-wrapper">
                <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor" style="color: var(--color-fg-muted); flex-shrink: 0;">
                    <path d="M10.68 11.74a6 6 0 0 1-7.922-8.982 6 6 0 0 1 8.982 7.922l3.04 3.04a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215ZM11.5 7a4.499 4.499 0 1 0-8.997 0A4.499 4.499 0 0 0 11.5 7Z"/>
                </svg>
                <input type="text" name="q" class="search-input" 
                       placeholder="Поиск по названию, авторам, ключевым словам..."
                       value="{{ query }}" autocomplete="off" autofocus>
                <button type="submit" class="btn btn-primary btn-sm">Найти</button>
            </div>
        </form>
    </div>

    <!-- Результаты -->
    {% if query %}
    <div style="margin-bottom: 16px; font-size: 14px; color: var(--color-fg-muted);">
        {% if results %}
        Найдено: <strong>{{ results|length }}</strong>
        {{ results|length|pluralize_ru('результат', 'результата', 'результатов') }}
        по запросу «<strong>{{ query }}</strong>»
        {% else %}
        Ничего не найдено по запросу «<strong>{{ query }}</strong>»
        {% endif %}
    </div>
    {% endif %}

    {% if results %}
    <div class="articles-list">
        {% for article in results %}
        <div class="card article-card">
            <h3 class="article-title">
                <a href="/article/{{ article.id }}">{{ article.title }}</a>
            </h3>
            <div class="article-authors">
                {{ article.authors_str or 'Автор не указан' }}
            </div>
            <div class="article-meta">
                {% if article.issue and article.issue.journal %}
                <span>{{ article.issue.journal.name }}</span>
                <span>№{{ article.issue.number }}/{{ article.issue.year }}</span>
                {% endif %}
                {% if article.pages_str %}
                <span>С. {{ article.pages_str }}</span>
                {% endif %}
                {% if article.doi %}
                <span>DOI: {{ article.doi }}</span>
                {% endif %}
            </div>
            {% if article.abstract %}
            <div style="margin-top: 8px; font-size: 14px; color: var(--color-fg-muted); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                {{ article.abstract }}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% elif query %}
    <div class="empty-state">
        <h3>Ничего не найдено</h3>
        <p>Попробуйте изменить поисковый запрос</p>
    </div>
    {% endif %}
</div>
{% endblock %}
